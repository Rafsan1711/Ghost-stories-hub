<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ghost Stories Hub</title>
  <style>/* ========== Global ========== */
* { box-sizing:border-box; margin:0; padding:0; }
body { font-family: sans-serif; background:#121212; color:#eee; }
.hidden { display:none; }
.screen { position:relative; width:100%; height:100vh; overflow:auto; }

/* ========== Login Screen ========== */
#login-screen { display:flex; align-items:center; justify-content:center; }
#login-screen .bg-image {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background: url('assets/images/Signin.png') center/cover no-repeat;
  z-index:0;
}
#login-btn {
  position:relative; z-index:1;
  padding:12px 24px; font-size:1rem;
  background:#4285F4; color:#fff;
  border:none; border-radius:4px;
  cursor:pointer;
}

/* ========== Feed Screen ========== */
.feed-header img {
  width:100%; height:auto; display:block;
}
.feed-controls {
  padding:10px;
  display:flex; flex-direction:column; align-items:flex-start; gap:10px;
}
.btn {
  padding:8px 16px; background:#5e0d0d; color:#fff;
  border:none; border-radius:4px; cursor:pointer;
}
.form {
  display:flex; flex-direction:column; gap:8px;
  width:100%;
}
.form input, .form textarea {
  padding:8px; background:#222; border:1px solid #555;
  border-radius:4px; color:#fff; width:100%;
}
#posts {
  padding:10px;
  display:flex; flex-direction:column; gap:12px;
}
.post-card {
  background: url('assets/images/Postbg.png') center/cover no-repeat;
  border-radius:6px; padding:16px;
}
.post-card h3 { margin-bottom:8px; }
.post-card p.meta {
  font-size:0.8rem; color:#ccc; margin-top:10px;
  text-decoration:underline; cursor:pointer;
}</style>
  <!-- Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

  <!-- LOGIN SCREEN -->
  <div id="login-screen" class="screen">
    <div class="bg-image"></div>
    <button id="login-btn" class="btn google">Sign in with Google</button>
  </div>

  <!-- FEED SCREEN -->
  <div id="feed-screen" class="screen hidden">
    <header class="feed-header">
      <img src="assets/images/Feed.png" alt="Feed Header" />
    </header>
    <div class="feed-controls">
      <button id="write-toggle" class="btn">Write a Story</button>
      <div id="story-form" class="form hidden">
        <input id="title" placeholder="Title" />
        <textarea id="body" rows="4" placeholder="Your horror story..."></textarea>
        <button id="post-btn" class="btn">Post Story</button>
      </div>
    </div>
    <main id="posts"></main>
  </div>

  <script>// — Firebase Initialization — 
const firebaseConfig = {
  apiKey: "AIzaSyAepf_M4EeW7QbXGKVc21Yb4nust240c4c",
  authDomain: "ghost-stories-hub-e372e.firebaseapp.com",
  databaseURL: "https://ghost-stories-hub-e372e-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "ghost-stories-hub-e372e",
  storageBucket: "ghost-stories-hub-e372e.firebasestorage.app",
  messagingSenderId: "387198854399",
  appId: "1:387198854399:web:cc70ebb7d6a19cc15e18ca"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.database();

// — DOM References —
const loginScreen = document.getElementById('login-screen');
const loginBtn    = document.getElementById('login-btn');
const feedScreen  = document.getElementById('feed-screen');
const writeToggle = document.getElementById('write-toggle');
const storyForm   = document.getElementById('story-form');
const postBtn     = document.getElementById('post-btn');
const postsEl     = document.getElementById('posts');

// — Auth State Listener —
auth.onAuthStateChanged(user => {
  if (user) {
    showScreen('feed');
    loadFeed();
    saveUser(user);
  } else {
    showScreen('login');
  }
});

// — Show Screens —
function showScreen(name) {
  loginScreen.classList.toggle('hidden', name !== 'login');
  feedScreen.classList.toggle('hidden', name !== 'feed');
}

// — Login Button —
loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .catch(err => alert('Sign-in error: ' + err.message));
};

// — Save User Info —
function saveUser(u) {
  db.ref('users/' + u.uid).set({
    email: u.email,
    username: u.displayName,
    createdAt: u.metadata.creationTime
  });
}

// — Toggle Story Form —
writeToggle.onclick = () => {
  storyForm.classList.toggle('hidden');
};

// — Post Story —
postBtn.onclick = () => {
  const title = document.getElementById('title').value.trim();
  const body  = document.getElementById('body').value.trim();
  if (!title || !body) return alert('Title এবং Story দুইটাই প্রয়োজন');
  db.ref('posts').push({
    uid: auth.currentUser.uid,
    title, story: body,
    timestamp: new Date().toISOString()
  });
  storyForm.classList.add('hidden');
  document.getElementById('title').value = '';
  document.getElementById('body').value  = '';
};

// — Load Feed —
function loadFeed() {
  db.ref('posts').on('value', snap => {
    const data = snap.val() || {};
    const arr  = Object.entries(data).map(([,v]) => v)
                     .sort(() => 0.5 - Math.random());
    postsEl.innerHTML = '';
    arr.forEach(post => {
      const card = document.createElement('div');
      card.className = 'post-card';
      card.innerHTML = `
        <h3>${post.title}</h3>
        <p>${post.story}</p>
        <p class="meta">${post.username} · ${new Date(post.timestamp).toLocaleString()}</p>`;
      postsEl.appendChild(card);
    });
  });
}</script>
</body>
</html>
